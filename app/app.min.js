/*
   app-dust-backbone - v0.0.0
*/
(function(){var e;(e=window.Inn)==null&&(window.Inn={}),Inn.Model=Backbone.Model.extend({url:function(){return"app/models/"+this.id+".json"}})}).call(this),function(){var e;(e=window.Inn)==null&&(window.Inn={}),Inn.Collection=Backbone.Collection.extend({url:function(){return"#"},model:Inn.Model})}.call(this),function(){var e,t={}.hasOwnProperty;(e=window.Inn)==null&&(window.Inn={}),Inn.ViewsCollection=function(){function e(){this._list={}}return e.prototype.add=function(e){var t,n;return this._list[(t=e.id)!=null?t:e.cid]==null&&(this._list[(n=e.id)!=null?n:e.cid]=e),this},e.prototype.remove=function(e){var t;return this._list[(t=e.id)!=null?t:e.cid]=void 0,this},e.prototype.render=function(){var e,n,r;r=this._list;for(e in r){if(!t.call(r,e))continue;n=r[e],n.on("ready",this.viewReadyHandler,this),n.render()}return this},e.prototype.stopRender=function(){var e,n,r;r=this._list;for(e in r){if(!t.call(r,e))continue;n=r[e],n.off("ready"),n.stopRender()}return this},e.prototype.viewReadyHandler=function(){return this.isRendered()&&(this.trigger("ready"),this.off("ready")),this},e.prototype.isRendered=function(){var e,n,r;r=this._list;for(e in r){if(!t.call(r,e))continue;n=r[e];if(!n.ready)return!1}return!0},e.prototype.get=function(e,t){return t==null&&(t=!1),this._list[e]},e.prototype.reset=function(){var e,n,r;r=this._list;for(e in r){if(!t.call(r,e))continue;n=r[e],n.ready=!1}return this},e.prototype.destroy=function(){var e,t,n;n=this._list;for(e in n)t=n[e],t.destroy();return this._list={},this},e.prototype.isEmpty=function(){var e,n;n=this._list;for(e in n){if(!t.call(n,e))continue;return!1}return!0},_.extend(e.prototype,Backbone.Events),e}()}.call(this),function(){var e;(e=window.Inn)==null&&(window.Inn={}),Inn.View=Backbone.View.extend({initialize:function(e,t){var n,r;return this.partials=t!=null?t:null,this.partials=(n=(r=this.partials)!=null?r:this.options.partials)!=null?n:[],this.children=new Inn.ViewsCollection,this._parent=null,this.ready=!1,this._rendering=!1},destroy:function(){return this.parent=null,this.undelegateEvents(),this.children.destroy(),this.trigger("destroyed",this),this},render:function(e,t){var n=this;return e==null&&(e=!1),t==null&&(t=!0),this._rendering&&this.stopRender(),this._rendering=!0,this.$el.data("view-template")!=null&&(this.options.templateName=this.$el.data("view-template")),this._loadTemplate(function(r){var i;return require((i=n.options.i18nRequire)!=null?i:[],function(){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;n._$memorizedEl=n.$el,n.$el=n.$el.clone(!0,!0),n.el=n.$el.get(),n.$el.html(r((v=(m=(g=n.options.model)!=null?g.toJSON():void 0)!=null?m:(y=n.options.dataManager)!=null?y.getDataAsset():void 0)!=null?v:{})),f=_.clone(n.options),f.partials=[],b=n.partials;for(u=c=0,p=b.length;c<p;u=++c)a=b[u],o=n.children.get((w=a.id)!=null?w:a.cid),i=n.$el.find("#"+a.id),o!=null?o.setElement(i):(a instanceof Inn.View?(l=a,l.options=_.extend({},f,l.options),l.setElement(i.get(0))):l=new Inn.View(_.extend({},f,{el:i.get(0)},a)),l._parent=n,n.children.add(l));E=n.pullChildren();for(u=h=0,d=E.length;h<d;u=++h)s=E[u],n.initPartial(s,f,!1);return e||n.children.isEmpty()?(n.isRoot()||(n.ready=!0),n._rendering=!1,t?n.replaceContext():n.trigger("readyForReplacement",n),n.trigger("ready")):(n.children.on("ready",_.bind(n._readyHandler,n,t)),n.children.render())})}),this},initPartial:function(e,t,n){var r,i;return t==null&&(t={}),n==null&&(n=!1),r=$(e),r.removeClass(this.options.partialClassName),i=new Inn.View(_.extend({},t,{el:r.get(0),id:r.attr("id")},r.data("view-options"))),i._parent=this,i.$el.addClass(this.options.partialClassName),n||this.children.add(i),i},replaceContext:function(){return this._$memorizedEl.replaceWith(this.$el),this._$memorizedEl=void 0},_readyHandler:function(e){return this.isRoot()||(this.ready=!0),this.children.reset(),this._rendering=!1,e?this.replaceContext():this.trigger("readyForReplacement",this),this.trigger("ready")},stopRender:function(){return this._rendering=!1,this.off("ready",this._readyHandler,this),this.children.stopRender(),this},_loadTemplate:function(e){var t,n,r=this;return n=function(){try{return jade.templates[r._getTemplateName()].apply(null,arguments)}catch(e){return typeof window.console!="undefined"&&typeof window.console.debug=="function"&&console.debug("tailbone view error ["+r._getTemplateName()+"]:",e.toString()),""}},jade.templates[this._getTemplateName()]!=null?setTimeout(function(){return e.call(this,n)}):(t=$.getScript(this._getTemplateURL(),function(){return e.call(r,n)}),t.fail(function(){e.call(r,function(){return""});if(typeof window.console=="object"&&typeof window.console.warn=="function")return console.warn("tailbone: failed to load template '"+r._getTemplateName()+"' from '"+r._getTemplateURL()+"'")})),this},_getTemplateURL:function(){var e;return e=this.options.templateFolder?"/":"",this.options.templateURL==null?this.options.templateFolder+e+this._getTemplateName()+"."+this.options.templateFormat:this.options.templateURL},_getTemplateName:function(){return this.options.templateName?this.options.templateName:"b"+this.id[0].toUpperCase()+this.id.slice(1)},pullChildren:function(){return this.$el.find("."+this.options.partialClassName)},reInitPartial:function(e){var t;return t=e.options,this.children.remove(e),this.children.add(this.initPartial(e.$el,t).render()),e.destroy()},isRoot:function(){return this._parent===null},options:{partialClassName:"bPartial",templateFolder:"",templateFormat:"js"}})}.call(this),function(){var e;(e=window.Inn)==null&&(window.Inn={}),Inn.DataManager=function(){function e(){this._dataSets=[],_.extend(this,Backbone.Events)}return e.prototype.addDataAsset=function(e,t){if(e instanceof Inn.Model||e instanceof Inn.Collection){if(!e.id&&!t)throw new Inn.Error("dataAsset id is required");return t&&(e.id=t),_.indexOf(this._dataSets,e)===-1&&this._dataSets.push(e),this.trigger("add:dataAsset",e),this}throw new Inn.Error("dataAsset shold be an instance of Inn.Model or Inn.Collection")},e.prototype.getDataAsset=function(e){var t;return t=_.find(this._dataSets,function(t){return t.id===e}),t!=null?t:null},e.prototype.removeDataAsset=function(e){var t;return t=_.reject(this._dataSets,function(t){return t.id===e}),this._dataSets.length===t.length?null:(this._dataSets=t,this.trigger("remove:dataAsset"))},e.prototype.destroy=function(){var e;return e=this,_.each(this._dataSets,function(t){return e.removeDataAsset(t.id)})},e}()}.call(this);